<!DOCTYPE html>
<html lang="en">
<head>
    <title>Video player</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link type="text/css" href="lib/video.js/dist/video-js.min.css" rel="stylesheet"/>
    <link type="text/css" href="lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <script type="application/javascript" src="lib/video.js/dist/video.min.js"></script>
    <script type="application/javascript" src="lib/videojs-youtube/dist/Youtube.min.js"></script>
    <script type="application/javascript" src="lib/compiled.min.js"></script>
</head>

<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-8">
            <div id="elm-app"></div>
        </div>
        <div class="col-lg-4">
            <video
                    id="mainPlayer"
                    class="video-js vjs-default-skin sticky-top"
                    controls
                    width="480" height="360"
            >
            </video>
        </div>
    </div>
</div>
<script>
    let app = Elm.Main.init({
        node: document.getElementById("elm-app")
    });
    const playerOptions = {
        techOrder: ["youtube"]
        , sources: [
            {
                type: "video/youtube"
                , src: "https://www.youtube.com/watch?v="
            }
        ]
        , youtube: {ytControls: 0}
    };
    let player = videojs("mainPlayer", playerOptions);
    const applyOptions = (player, options) => {
        player.loop(options.loop);
        player.off("ended");
        player.one("ended", (_) => app.ports.videoEnded.send("ended"));
    };

    app.ports.sendUrlWithOptions.subscribe(function (urlWithOptions) {
        player.src({src: urlWithOptions.url, type: 'video/youtube'});
        applyOptions(player, urlWithOptions.options);
        if (urlWithOptions.options.play)
            player.play();
    });

    app.ports.sendOptions.subscribe(function (options) {
        applyOptions(player, options);
    });

</script>
</body>
</html>
